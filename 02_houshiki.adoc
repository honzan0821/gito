## 方式検討

### 最近の認証認可の状況調査
現在に認証認可のデファクトスタンダードになっているのは、Oauth2.0をベースとしたOpen ID Connectになっている。 +

OAuth登場以前は、ユーザーがAアプリケーションを使用する際に、Bアプリケーションの情報を取得する場合は、Aアプリケーションに対しBアプリケーションの認証情報を登録しておく必要があった。これはAアプリケーションに悪意があったり、脆弱性があるなどで、悪用されるリスクがあった。  

OAuth登場以後は、AアプリケーションがBアプリケーションにアクセスする際に、ユーザーがAアプリケーションにBアプリケーションの認証情報を渡すことなく、アクセスを許可する仕組みをつくることが可能になった。

Aアプリケーションのアクセス時に、ユーザーは認証を行う必要があるが、Bアプリケーションの認証が成功した際に、Aアプリケーションへアクセストークンが発行されることをもって、Aアプリケーションも認証したとするユースケースがでてきた。（ソーシャルログイン）OAuthは**認可**のプロトコルであり、認証部分は規定されていないため、様々な独自実装が出現し、実装によっては脆弱性も指摘されるようになった。


この状況の中、OAuthを拡張し、**認証**に対応したOpen ID Connectが登場した。

NOTE: 本資料では連携方法については述べないが、APIから直接データを取得できるケースや、クローリング／スクレイピングしてhtmlから必要なデータを取得することを行っていた。

WARNING: Oauthダンス中のBアプリケーションの認可前の認証は、OAuthでもOIDCでも対象外だと思っているけど本当か？ +   
SSOとIDフェデレーションと認証認可とOauthとOIDC/samlの整理がよくわからん。
SSO方式の１つがIDフェデレーションなのはわかるが、OAuthはIDフェデレーションの一種？認可なので違う？
認証認可って言葉が自分の中で定義できてないので、意味わからんことになってるのか？

参考
https://www.osstech.co.jp/_media/techinfo/opensso/osstech-opensso-study-oauth.pdf

### OAuthを中心とした認証認可の標準仕様について
認証認可に関連するRFCや標準化団体の仕様について主要なものを以下に整理する。

.認証認可に関連するRFCや標準化団体の仕様一覧
[options="autowidth"]
|===
|公開日 |RFC等 |タイトル
| 2012/10 | RFC6749 |The OAuth 2.0 Authorization Framework
| 2012/10 | RFC6750 |The OAuth 2.0 Authorization Framework: Bearer Token Usage
| 2013/8 | RFC7009 |OAuth 2.0 Token Revocation
| 2014/11 | OpenID Foundation |OpenID Connect Core 1.0 incorporating errata set 1
| 2014/11 | OpenID Foundation |OpenID Connect Core 1.0 incorporating errata set 1
| 2015/9 | RFC7638 |Proof Key for Code Exchange by OAuth Public Clients(PKCE)
| 2015/10 | RFC7662 |OAuth 2.0 Token Introspection
| 2019/8 | RFC8628 |OAuth 2.0 Device Authorization Grant
| 2020/1 | RFC8693 |OAuth 2.0 Token Exchange
| 2020/2 | RFC8725/BCP225 |JSON Web Token Best Current Practices
| 2021/8 | RFC9101 |The OAuth 2.0 Authorization Framework: JWT-Secured Authorization Request (JAR)
| 2021/9 | RFC9126 |OAuth 2.0 Pushed Authorization Requests(PAR)
| 2021/9 | OpenID Foundation |OpenID Connect Client-Initiated Backchannel Authentication Flow - Core 1.0(CIBA)

| 2022/11 | draft-ietf-oauth-rar-15 |OAuth 2.0 Rich Authorization Requests(RAR)
| 2022/8 | draft-ietf-oauth-dpop-11 |OAuth 2.0 Demonstrating Proof-of-Possession at the Application Layer(DPoP)

// BCP
| 2022/9 | draft-ietf-oauth-security-topics-21 |OAuth 2.0 Security Best Current Practice

// FAPI1.0関係仕様
| 2019/8 | OpenID Foundation  |Financial-grade API: Client Initiated Backchannel Authentication Profile
| 2021/3 | OpenID Foundation  |Financial-grade API Security Profile 1.0 - Part 1: Baseline
| 2021/3 | OpenID Foundation  |Financial-grade API Security Profile 1.0 - Part 2: Advanced

// OpenID Connect Logout specifications
| 2022/9 | OpenID Foundation  | OpenID Connect Session Management 1.0
| 2022/9 | OpenID Foundation  | OpenID Connect Front-Channel Logout 1.0
| 2022/9 | OpenID Foundation  | OpenID Connect Back-Channel Logout 1.0
| 2022/9 | OpenID Foundation  | OpenID Connect RP-Initiated Logout 1.0

// JWT関連
| 2015/5 | RFC7515 | JSON Web Signature (JWS)
| 2015/5 | RFC7516 | JSON Web Encryption (JWE)
| 2015/5 | RFC7517 | JSON Web Key (JWK)
| 2015/5 | RFC7518 | JSON Web Algorithms (JWA)
| 2015/5 | RFC7519 | JSON Web Token (JWT)

|===


参考

OAuth 2.0 と JWT 関連 RFC
https://uechi.io/blog/oauth-jwt-rfcs/

複雑に関係しあうJWTまわりの仕様を見る: JWS (JSON Web Signature)
https://kiririmode.hatenablog.jp/entry/20170225/1488020088

OAuth 2.0
https://oauth.net/2/

Financial-grade API (FAPI) 勉強会
https://storage.googleapis.com/authlete-website/slides/2022-01-12_fapi1.pdf

OpenID Connect CIBA 実装の具体例と考慮すべきポイント
https://www.nri-secure.co.jp/blog/openid-connect-ciba-implementation

FAPI-CIBA プロファイル
https://qiita.com/TakahikoKawasaki/items/f478e2fd07b7236d6fbe

現在仕様策定中の OpenID Connect RP-Initiated Logout 1.0 とは
https://ritou.hatenablog.com/entry/2020/08/25/012417
